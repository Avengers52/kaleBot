package com.kalebot.config;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.kalebot.vuln.NvdClient;
import com.kalebot.vuln.OsvClient;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.web.reactive.function.client.WebClient;

@Configuration
public class VulnerabilityClientConfig {
  @Bean
  public OsvClient osvClient(
      WebClient.Builder builder,
      JdbcTemplate jdbcTemplate,
      ObjectMapper objectMapper,
      @Value("${osv.base-url:https://api.osv.dev}") String osvBaseUrl
  ) {
    WebClient webClient = builder.baseUrl(osvBaseUrl).build();
    return new OsvClient(webClient, jdbcTemplate, objectMapper);
  }

  @Bean
  public NvdClient nvdClient(
      WebClient.Builder builder,
      JdbcTemplate jdbcTemplate,
      ObjectMapper objectMapper,
      @Value("${nvd.base-url:https://services.nvd.nist.gov/rest/json/cves/2.0}") String nvdBaseUrl,
      @Value("${nvd.api-key:}") String apiKey
  ) {
    WebClient webClient = builder.baseUrl(nvdBaseUrl).build();
    return new NvdClient(webClient, jdbcTemplate, objectMapper, apiKey);
  }
}
