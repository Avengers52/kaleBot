package com.kalebot.controller;

import com.kalebot.core.VulnerabilityScanService;
import com.kalebot.model.vuln.ScanReport;
import com.kalebot.model.vuln.VulnerabilityScanRequest;
import jakarta.validation.Valid;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Mono;

@RestController
@RequestMapping("/api/vuln")
public class VulnerabilityController {
  private final VulnerabilityScanService vulnerabilityScanService;

  public VulnerabilityController(VulnerabilityScanService vulnerabilityScanService) {
    this.vulnerabilityScanService = vulnerabilityScanService;
  }

  @PostMapping("/scan")
  public Mono<ScanReport> scan(@Valid @RequestBody VulnerabilityScanRequest request) {
    return vulnerabilityScanService.scan(request.inputType(), request.content());
  }
}
